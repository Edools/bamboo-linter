{"version":3,"sources":["index.min.js","/source/index.js"],"names":["_slicedToArray","arr","i","Array","isArray","Symbol","iterator","Object","_arr","_n","_d","_e","undefined","_s","_i","next","done","push","value","length","err","TypeError","global","factory","exports","module","require","define","amd","ThemeQA","fs","R","rx","bluebird","chalk","fetch","cheerio","this","getApps","path","providers_config__readFile","encoding","then","json","JSON","parse","apps","toArray","utils__error","getAppRelease","_ref","name","version","getThemeConfig","config","getRequestHeaders","res","headers","Authorization","token","map","app","keys","lint","html","expectations","$","load","onlyMessages","R__default","exp","isValid","hasAttribute","_ref2","elems","regexp","RegExp","escapeRegex","matchesAttr","elem","test","attribs","any","hasElement","_ref3","attributes","matchesAllAttrs","attrs","matchesOrNoExpect","attr","all","arguments","replace","expectation","fn","type","renderMessage","rendered","renderAttribute","renderElement","_expectation$message$split","message","split","_expectation$message$split2","prefix","suffix","_ref4","spacer","join","renderedAttrs","consoleReporter","filename","messages","utils__info","forEach","_message","target","utils__highlight","hasTemplates","lstatSync","e","readHTML","index__readFile","getTemplates","_ref5","templatesDir","templateNames","Observable","from","flatMap","parsedName","fromPromise","lintTemplate","template","validateTheme","console","log","source","appfileDir","filter","_ref6","release","reduce","templates","concat","hasAnyMessage","_ref7","_ref8","console__default","Error","utils__success","just","subscribe","helpers","noop","compose","bold","red","green","underline","yellow","promisify","readFile","not","is","Boolean"],"mappings":"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","file":"index.min.js","sourcesContent":[null,"(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('fs'), require('ramda'), require('rx'), require('bluebird'), require('chalk'), require('node-fetch'), require('cheerio')) :\n  typeof define === 'function' && define.amd ? define(['exports', 'fs', 'ramda', 'rx', 'bluebird', 'chalk', 'node-fetch', 'cheerio'], factory) :\n  factory((global.ThemeQA = {}), global.fs, global.R, global.rx, global.bluebird, global.chalk, global.fetch, global.cheerio)\n}(this, function (exports, fs, R, rx, bluebird, chalk, fetch, cheerio) { 'use strict';\n\n  fs = ('default' in fs ? fs['default'] : fs);\n  var R__default = ('default' in R ? R['default'] : R);\n  chalk = ('default' in chalk ? chalk['default'] : chalk);\n  fetch = ('default' in fetch ? fetch['default'] : fetch);\n\n  let utils__error = R.compose(console.log, chalk.bold.red);\n  let utils__success = R.compose(console.log, chalk.bold.green);\n  let utils__info = R.compose(console.log, chalk.underline);\n  let utils__highlight = R.compose(console.log, chalk.bold.yellow);\n\n  const providers_config__readFile = bluebird.promisify(fs.readFile);\n\n  function getApps (path) {\n    return providers_config__readFile(path, {encoding: 'utf8'})\n      .then(json => JSON.parse(json))\n      .then(apps => toArray(apps))\n      .catch(() => utils__error('Your Appfile doesn\\'t exist'));\n  }\n\n  function getAppRelease ({name, version}) {\n    return getThemeConfig()\n      .then(config => {\n        return fetch(`https://api.myedools.com/apps/${name}/releases/${version}`, getRequestHeaders(config));\n      })\n      .then(res => res.json());\n  }\n\n  function getThemeConfig () {\n    return providers_config__readFile('theme-config.json', {encoding: 'utf8'})\n      .then(res => JSON.parse(res))\n      .catch(err => utils__error('There is something wrong with your theme config file!', err));\n  }\n\n  function getRequestHeaders (config) {\n    return {\n      headers: {\n        Authorization: `Token token=${config.token}`\n    }\n    };\n  }\n\n  function toArray (apps) {\n    return R.map(app => ({\n      name: app,\n      version: apps[app]\n    }), R.keys(apps));\n  }\n\n  const onlyMessages = R__default.filter(R__default.compose(R__default.not, R__default.is(Boolean)));\n\n  function lint (html, expectations) {\n    let $ = cheerio.load(html);\n    return onlyMessages(R__default.map(exp => isValid($, exp), expectations));\n  }\n\n  function hasAttribute ($, {name, value}) {\n    let elems = $(`[${name}]`);\n    let regexp = new RegExp(escapeRegex(value));\n    let matchesAttr = elem => regexp.test(elem.attribs[name]);\n\n    return R__default.any(matchesAttr, elems);\n  }\n\n  function hasElement ($, {name, attributes}) {\n    let elems = $(`${name}`);\n    let matchesAllAttrs = elem => {\n      let attrs = R__default.keys(elem.attribs);\n      let matchesOrNoExpect = attr => {\n        let regexp = new RegExp(escapeRegex(attributes[attr]));\n        return !attributes[attr] || regexp.test(elem.attribs[attr]);\n      };\n      return R__default.all(matchesOrNoExpect, attrs);\n    };\n\n    return R__default.any(matchesAllAttrs, elems);\n  }\n\n  function escapeRegex (value = '') {\n    return value\n      .replace(/\\(/g, '\\\\(')\n      .replace(/\\)/g, '\\\\)');\n  }\n\n  function isValid ($, expectation) {\n    let fn = expectation.type === 'A' ? hasAttribute : hasElement;\n    return fn($, expectation) ? true : renderMessage(expectation);\n  }\n\n  function renderMessage (expectation) {\n    let rendered = expectation.type === 'A'\n      ? renderAttribute(expectation.name, expectation.value)\n      : renderElement(expectation);\n    let [prefix, suffix] = expectation.message.split('{{ value }}');\n\n    return [prefix, rendered, suffix];\n  }\n\n  function renderAttribute (name, value) {\n    return `${name}=\"${value}\"`;\n  }\n\n  function renderElement ({name, attributes}) {\n    let spacer = R__default.join(' ');\n    let renderedAttrs = R__default.map(attr => {\n      return renderAttribute(attr, attributes[attr]);\n    }, R__default.keys(attributes));\n\n    return `<${name} ${spacer(renderedAttrs)}></${name}>`;\n  }\n\n  function consoleReporter (filename, messages) {\n    if (messages && messages.length > 0) {\n      utils__info(`${filename} :`);\n      R.forEach(message => {\n        let [prefix, target, suffix] = message;\n        utils__error(prefix);\n        utils__highlight(`     ${target}`);\n        utils__error(suffix, '\\n');\n      }, messages);\n    }\n  }\n\n  var console__default = consoleReporter;\n\n  const index__readFile = bluebird.promisify(fs.readFile);\n\n  function hasTemplates(path) {\n    try {\n      return fs.lstatSync(path);\n    } catch (e) {\n      utils__error('Your template folder doesn\\'t exist');\n    }\n  }\n\n  function readHTML (path) {\n    return index__readFile(path, {encoding: 'utf8'});\n  }\n\n  function getTemplates ({expectations}, templatesDir) {\n    let templateNames = Object.keys(expectations);\n\n    return rx.Observable.from(templateNames)\n      .flatMap(name => {\n        let parsedName = `${name}.html`;\n        return rx.Observable.fromPromise(readHTML(`${templatesDir}/${parsedName}`))\n          .map(html => ({\n            name: parsedName,\n            html: html,\n            expectations: expectations[name]\n          }));\n      });\n  }\n\n  function lintTemplate (template) {\n    template.messages = lint(template.html, template.expectations);\n    return template;\n  }\n\n  function validateTheme (config) {\n    console.log('Linting your Edools theme...');\n    if (!hasTemplates(config.templatesDir)) {\n      return;\n    }\n\n    let source = rx.Observable.fromPromise(getApps(config.appfileDir))\n      .flatMap(apps => rx.Observable.from(apps))\n      .filter(({name}) => name !== 'bamboo')\n      .flatMap(app => rx.Observable.fromPromise(getAppRelease(app)))\n      .flatMap(release => getTemplates(release, config.templatesDir))\n      .map(template => lintTemplate(template))\n      .reduce((templates, template) => {\n        templates = templates.concat(template);\n        return templates;\n      }, [])\n      .map(templates => {\n        let hasAnyMessage = R.any(({messages}) => messages.length > 0, templates);\n        if (hasAnyMessage) {\n          R.forEach(({name, messages}) => console__default(name, messages), templates);\n          throw new Error('Your theme isn\\'t valid');\n        } else {\n          utils__success('Your theme is valid!');\n        }\n      })\n      .catch(err => {\n        utils__error(err);\n        return rx.Observable.just();\n      });\n\n    source.subscribe(rx.helpers.noop);\n  }\n\n  exports.validateTheme = validateTheme;\n\n}));\n"],"sourceRoot":"/source/"}